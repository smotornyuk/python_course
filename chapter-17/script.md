# Лекция 17

(Говорящая голова)

И снова привет. Мы наконец-то добрались до темы, в которой вы будете
чувствовать себя вполне уверенными. Всё сегодняшнее занятие будет
посвящено работе с базами данных. Ну чтобы всё не оказалось чересчур
скучным, вместо обычного подхода, с написанием sql-запросов, мы будем
использовать стилистику пропагандируемую Django.  Основное отличие от
всего, что вы знали — это полнейшее отсутствие какого бы то ни было
SQL и максимальное использование объектно-ориентированного
программирования. Тут его будет настолько много, что временами Будет
казаться что в коде скрыта какая-то магия, но Мы то знаем что Маги не
бывает. Кстати, многие предпочитают работать с Django именно из-за
того как здесь реализован процесс взаимодействия с базой данных. Так
что надеюсь, он вам тоже понравится

(видео конспект)


17-01-model

----------------------------------------------------------------

(Говорящая голова)

А сейчас у вас должно возникать ощущение что Вам приходится делать
очень много ты. Выходит, мы определяем какой-то класс, в котором
полностью описываем нашу таблицу, а потом ещё это таблицу нужное
создать? Вот тут Вы не правы. Вам нужно только определить Класс, всё
остальное за вас сделает Django.  Задача фреймворка, обеспечить
максимальную совместимость и воспроизводимость кода на разных
компьютерах. Потому, если каждый разработчик будет вручную себя
создавать все необходимые таблицы в базе данных кто наверняка кто-то
где-то допустят ошибку. Дабы это избежать, вы описываете только
модель. Все остальные служебные действия по созданию таблиц,
обновлению колонок и так далее берёт на себя используем вами
фреймворк, то есть Django. Наша задача сейчас создать на основе
описанной модели файл миграции — это некий документ, описывающий
преобразование базы данных на протяжении существования проекта. Когда
вы только начали работать над проектом никаких таблицы ещё не
существовало. Потом появилась модель статей. В этот момент возникает
первая миграция — Создание первой таблицы. Со временем У вас появилась
еще одна модель комментариев — тогда вам нужно сгенерировать вторую
миграцию создание таблицы комментариев. Если к вашему проекту
присоединяется новый разработчик, у него есть описание всех миграций —
и он может последовательно Произвести все необходимые манипуляции с
базой данных — сначала создать таблицу статей, потом создать таблицу
комментариев. Со временем вы будете добавлять какие-то колонки в
таблице, удалять какие-то данные — Для всего этого будут
генерироваться миграции и весь процесс эволюции данных вашего
приложения будет задокументирован вместе с кодом. А потому любой новый
разработчик всегда сможет легко создать экосистему вашего проекта , Да
и вы сможете откатиться на более ранняя версия в случае если что-то
пойдет не так.

(видео конспект)


17-02-migrations

----------------------------------------------------------------

(Говорящая голова)

И что дальше? Да вот в принципе и всё, только что Django создал в
нашей базе данных все необходимые таблицы, И мы можем приступать к
работе. Как уже говорилось не раз, никаких эскуэль команд вы здесь не
увидите — весь процесс автоматизирован. Наша задача только выучить
необходимые классы и методы этих классов, которые сильно помогут нам в
написании сайтов. После того как мы создали все необходимые таблицы мы
можем начинать работать с данными. Покажешь что, весь процесс
взаимодействия с таблицей будет совершаться в консоли. Потому что
таким образом вы сможете увидеть то, как работают сами модели, не
перемешивая их с версткой и рендерингом шаблонов. Не переживайте со
временем мы вернемся в браузер и увидим Как создавать данные с помощью
симпатичного User интерфейса.

(видео конспект)

17-03-save

----------------------------------------------------------------

(Говорящая голова)

Теперь можно переключиться на выборку данных из базы. Но прежде чем мы
сильно влюбился в этот процесс нам не мешало бы иметь какие-то
реальные данные. Ну, хотя бы условно реальные. Нужно каким-то образом
сгенерировать десяток-другой статей, с каким-то случайным заголовком
контентом и автором. Я надеюсь, что вы настолько же лениво насколько и
я , и не захотите вручную всё это печатать. Поэтому я расскажу вам про
одной небольшой но очень удобную библиотеку для генерации в случайных
данных по заданным требованиям. И после того как у нас будет Пару
десятков записей, мы сможем начать получать их, фильтровать и делать
кучу интересных вещей

(видео конспект)

17-04-data-generation

----------------------------------------------------------------

(Говорящая голова)

Вот теперь, имея больше 60 записей в базе, Ну можем перейти к самому
сложному и крутому процессу базы данных - поиску. Так как SQL мы не
используем, придётся ограничиться какими-то методами Django.  Хотя
один из методов, подсчет записи мы уже использовали , Если не
учитывать длину строки — ничего сложного там не было. Тут нужно понять
только общую идею организации процесса. Если мы хотим создать обновить
или удалить конкретную статью, которая у нас уже присутствует в виде
объекта в переменной — там и будем работать именно с этим объектом. Но
если у нас еще нет искомой статьи и нам ee нужно достать из базы
данных — то мы пока не можем работать с конечной переменной, потому
что ее просто нет и нам нужно выбрать некую точку входа , место
контакта с SQL. Для этого мы будем использовать еще одно из скрытых
свойств нашего класса статьи , которая символизирует все записи в
таблице статей. Я называю это свойство скрытым, Но на самом деле онo
самoe обычнoe, Мы просто не говорили о нём явно и унаследовали его из
родительского класса модели.

(видео конспект)


17-05-all-slice

----------------------------------------------------------------

(Говорящая голова)

Следующий вопрос который возникает, Как получить не всё то информацию
а только отдельные Поля — если Меня интересуют только автор , Зачем
мне получать ещё и контент с заголовком. Во-вторых, временами мне
захочется данные ещё и сортировать , например по убыванию рейтинга.
Ну и конечно же, если буду получать значения Только 1 колонки , мне
захочется избавиться от дубликатов. Что же, пожелания такие вполне
оправданы и нам осталось только разобраться, как их реализовать в
терминологии используемой системы

(видео конспект)


17-06-distinct-values-order

----------------------------------------------------------------

(Говорящая голова)

Ну и самое главное часть, которую я откладывал напоследок. Просто
потому что она самая волшебная из того, что предоставляет Django.
Фильтрация данных. Разумеется вы не захотите каждый раз выбрать
абсолютно все записи из базы данных, либо только первые 10. Чаще всего
вам понадобится извлечь все записи в которых имя автора равно чему-то
определенному. Либо все записи чей рейтинг находятся в диапазоне от и
до . Либо все записи созданные определенного числа. В общем, вам
определённо нужно научиться фильтровать данные. Фильтрация в Django
имеет две формы — Вы можете фильтровать, оставляя только те записи,
которые удовлетворяют neocom условию , Либо вы можете исключать,
удаляя записи которые соответствуют условию. В целом, результат не
изменится, но исторически сложилось так, что присутствуют две формы
поиска. Они вполне совместимы и взаимозаменяемы, так что я обычно
предпочитаю первую форму

(видео конспект)


17-07-filter-exclude

----------------------------------------------------------------

(Говорящая голова)

Кажется, я что-то упустил. Если у вас возникло желание оставить все
записи, которые были созданы в 14:00, то вы знаете, что именно. Тут не
хватает фильтрации по неточному совпадению , как, например, поиск всех
статей с рейтингом больше чем некая граница, поиск всех статей с одним
из допустимых авторов. Если кратко — поиск по нечеткому
совпадению. Удивительно, но для этого используются те же самые методы
фильтрации, отличается лишь способ передачи аргументов в них. Этот
синтаксис немного странноватый, но он вполне укладывается в
возможности питона , так что не стоит сильно удивляться при просмотре
следующего фрагмента.

(видео конспект)

17-08-filter-operators

----------------------------------------------------------------

(Говорящая голова)

Ну и последняя возможность поиска которую мы смотрим сегодня. Она
также связана с фильтрацией , и, в принципе, нужно в той ситуации,
когда синтаксис питона не позволяет разгуляться. Сейчас мы рассмотрим
две дополнительные возможности в. Первая из них, это поиск по
нескольким критериям в разных комбинациях, временами Вы можете
захотеть, чтобы все критерии поиска выполнялись, временами вам будет
достаточно выполнение лишь одной.  И вторая возможность это
использование в операциях уже существующих полей. Например, У
некоторых статей есть рейтинг и вам хотелось бы увеличить этот рейтинг
на единицу.  Вы не знаете наверняка, Каково будет значение рейтинга в
следующий момент, вы знаете только то, что она должна возрасти на
единицу. Для этого нам придётся подключить несколько дополнительных
классов.

(видео конспект)


17-09-q-f


----------------------------------------------------------------

(Говорящая голова)

Вот Мы закончили ознакомление с нелегкой жизни моделей Django и к
этому моменту Вы уже должны, как минимум, быть согласна с тем что не
крайний прикольные. К ним быстро привыкаешь использовать и гораздо
проще чем SQL , хотя бы по двум причинам. Первая, вам не нужно
беспокоиться о тонкостях, синтаксисе, стандартах которой присутствует
в SQL в. Вам даже не нужно заморачиваться используемой системой
управления базами данных - вы просто вызываете необходимые методы и
они будут преобразованы в наиболее подходящий sql-запрос в данной
ситуации. Вторая причина более прозаичнa — вы дольше учили питон,
потому кот на нём должен был оказаться гораздо проще и очевиднее. Если
мы заговорили на эту тему, то я как-то находил библиотеку, которая
преобразует код на питоне в код на JavaScript, Видимо у кого-то очень
плохо складывались дела со вторым и он решил помочь будущим
поколениям. Весьма любопытная штука, Хотя я не думаю что ее стоит
использовать в реальных проектах. Тем более эти два языка почти не
отличаются , Так что освоить второй, зная один из них это крайне
тривиальная задача.

Рассказать всё это, я могу с чистой совестью идти отдыхать и готовить
материал для нашего последнего занятия , в котором мы снова вернёмся в
Так полюбившийся нам HTML и попытаемся совместить всё знания о Django
в одну стабильно работающую систему . До встречи на следующем уроке